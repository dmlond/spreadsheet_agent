<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: SpreadsheetAgent::Agent
  
    &mdash; Documentation by YARD 0.8.7.1
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (A)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../SpreadsheetAgent.html" title="SpreadsheetAgent (module)">SpreadsheetAgent</a></span></span>
     &raquo; 
    <span class="title">Agent</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: SpreadsheetAgent::Agent
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="Db.html" title="SpreadsheetAgent::Db (class)">Db</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="Db.html" title="SpreadsheetAgent::Db (class)">Db</a></span></li>
          
            <li class="next">SpreadsheetAgent::Agent</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/spreadsheet_agent/agent.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>The license of this source is “MIT Licence”</p>
</div>
  </div>


<p>SpreadsheetAgent::Agent is designed to make it easy to create a single task
which connects to a field within a record on a page within the configured
SpreadsheetAgent compatible Google Spreadsheet, runs supplied code, and
reports whether the job completed or ended in error.  An agent can be
configured to only run when certain prerequisite fields have completed. 
The data in these fields can be filled in by other
SpreadsheetAgent::Agents, SpreadsheetAgent::Runners, or humans.  Compute
node configuration is available to prevent the agent from running more than
a certain number of instances of itself, or not run if certain other agents
or processes are running on the node.  Finally, an agent can be configured
to subsume another agent, and fill in the completion field for that agent
in addition to its own when it completes successfully.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Author:</p>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>Darin London Copyright 2013</p>
</div>
      
    </li>
  
</ul>

</div>



  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#agent_name-instance_method" title="#agent_name (instance method)">- (Object) <strong>agent_name</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The name of the field in the page to which the agent should report status.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#conflicts_with-instance_method" title="#conflicts_with (instance method)">- (Object) <strong>conflicts_with</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Hash of process_name to number of max_instances.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#debug-instance_method" title="#debug (instance method)">- (Object) <strong>debug</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Boolean.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#keys-instance_method" title="#keys (instance method)">- (Object) <strong>keys</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>hash of key-value pairs.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#max_selves-instance_method" title="#max_selves (instance method)">- (Object) <strong>max_selves</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Optional integer.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#page_name-instance_method" title="#page_name (instance method)">- (Object) <strong>page_name</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The name of the Page on the Google Spreadsheet that contains the record to
be worked on by the agent.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#prerequisites-instance_method" title="#prerequisites (instance method)">- (Object) <strong>prerequisites</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Optional array of prerequisite fields that must contain a 1 in them for the
record on the page before the agent will attempt to run.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#subsumes-instance_method" title="#subsumes (instance method)">- (Object) <strong>subsumes</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Array of fields on the record which this agent subsumes.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#worksheet-instance_method" title="#worksheet (instance method)">- (Object) <strong>worksheet</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Readonly access to the GoogleDrive::Worksheet that is being access by the
agent.</p>
</div></span>
  
</li>

    
  </ul>



  
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="Db.html" title="SpreadsheetAgent::Db (class)">Db</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Db.html#config-instance_method" title="SpreadsheetAgent::Db#config (method)">#config</a></span>, <span class='object_link'><a href="Db.html#config_file-instance_method" title="SpreadsheetAgent::Db#config_file (method)">#config_file</a></span>, <span class='object_link'><a href="Db.html#db-instance_method" title="SpreadsheetAgent::Db#db (method)">#db</a></span>, <span class='object_link'><a href="Db.html#session-instance_method" title="SpreadsheetAgent::Db#session (method)">#session</a></span></p>


  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_entry-instance_method" title="#get_entry (instance method)">- (Object) <strong>get_entry</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the GoogleDrive::List object for the specified keys.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Agent) <strong>initialize</strong>(attributes) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>create a new SpreadsheetAgent::Agent with the following: == required
configuration parameters: * agent_name * page_name * keys.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process%21-instance_method" title="#process! (instance method)">- (Object) <strong>process!</strong>(&amp;agent_code) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>If the agent does not have any conflicting processes (max_selves or
conflicts_with) and if the entry is ready (field 'ready' has a 1), and all
prerequisite fields have a 1, gets the GoogleDrive::List record, and passes
it to the supplied agent_code PROC as argument.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="Db.html" title="SpreadsheetAgent::Db (class)">Db</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Db.html#build_db-instance_method" title="SpreadsheetAgent::Db#build_db (method)">#build_db</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="SpreadsheetAgent::Agent (class)">Agent</a></span></tt>) <strong>initialize</strong>(attributes) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>create a new SpreadsheetAgent::Agent with the following:</p>

<h2>required configuration parameters:</h2>
<ul><li>
<p>agent_name</p>
</li><li>
<p>page_name</p>
</li><li>
<p>keys</p>
</li></ul>

<h2>optional parameters:</h2>
<ul><li>
<p>config_file: (see SpreadsheetAgent::DB)</p>
</li><li>
<p>debug</p>
</li><li>
<p>prerequisites</p>
</li><li>
<p>max_selves</p>
</li><li>
<p>conflicts_with</p>
</li><li>
<p>subsumes</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spreadsheet_agent/agent.rb', line 67</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span>
  <span class='ivar'>@agent_name</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='symbol'>:agent_name</span><span class='rbracket'>]</span>
  <span class='ivar'>@page_name</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='symbol'>:page_name</span><span class='rbracket'>]</span>
  <span class='ivar'>@keys</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='symbol'>:keys</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_clone'>clone</span>
  <span class='kw'>unless</span> <span class='ivar'>@agent_name</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@page_name</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@keys</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>SpreadsheetAgentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>agent_name, page_name, and keys attributes are required!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='ivar'>@config_file</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='symbol'>:config_file</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_build_db'>build_db</span><span class='lparen'>(</span><span class='rparen'>)</span>

  <span class='ivar'>@worksheet</span> <span class='op'>=</span> <span class='ivar'>@db</span><span class='period'>.</span><span class='id identifier rubyid_worksheet_by_title'>worksheet_by_title</span><span class='lparen'>(</span><span class='ivar'>@page_name</span><span class='rparen'>)</span>
  <span class='ivar'>@debug</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='symbol'>:debug</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='symbol'>:prerequisites</span><span class='rbracket'>]</span>
    <span class='ivar'>@prerequisites</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='symbol'>:prerequisites</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_clone'>clone</span>
  <span class='kw'>end</span>

  <span class='ivar'>@max_selves</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='symbol'>:max_selves</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='symbol'>:conflicts_with</span><span class='rbracket'>]</span>
    <span class='ivar'>@conflicts_with</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='symbol'>:conflicts_with</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_clone'>clone</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='symbol'>:subsumes</span><span class='rbracket'>]</span>
    <span class='ivar'>@subsumes</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='symbol'>:subsumes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_clone'>clone</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="agent_name=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="agent_name-instance_method">
  
    - (<tt>Object</tt>) <strong>agent_name</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The name of the field in the page to which the agent should report status</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spreadsheet_agent/agent.rb', line 18</span>

<span class='kw'>def</span> <span class='id identifier rubyid_agent_name'>agent_name</span>
  <span class='ivar'>@agent_name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="conflicts_with=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="conflicts_with-instance_method">
  
    - (<tt>Object</tt>) <strong>conflicts_with</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Hash of process_name to number of max_instances.  This works on Linux with
ps.  If the agent detects the specified number of max_instances of the
given process (based on a line match), it will not attempt to run</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


44
45
46</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spreadsheet_agent/agent.rb', line 44</span>

<span class='kw'>def</span> <span class='id identifier rubyid_conflicts_with'>conflicts_with</span>
  <span class='ivar'>@conflicts_with</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="debug=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="debug-instance_method">
  
    - (<tt>Object</tt>) <strong>debug</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Boolean. When true, the agent code will print verbosely to STDERR.  When
false, and the process! returns a failure status, the agent will email all
stdout and stderr to the email specified in the :config send_to value</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spreadsheet_agent/agent.rb', line 31</span>

<span class='kw'>def</span> <span class='id identifier rubyid_debug'>debug</span>
  <span class='ivar'>@debug</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="keys=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="keys-instance_method">
  
    - (<tt>Object</tt>) <strong>keys</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>hash of key-value pairs.  The keys are defined in config/agent.conf.yml. 
The values specify the values for those fields in the record on the page
for which the agent is running. All keys configured as 'required: 1' in
config/agent.conf.yml must be included in the keys hash</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spreadsheet_agent/agent.rb', line 26</span>

<span class='kw'>def</span> <span class='id identifier rubyid_keys'>keys</span>
  <span class='ivar'>@keys</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="max_selves=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="max_selves-instance_method">
  
    - (<tt>Object</tt>) <strong>max_selves</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Optional integer.  This works on Linux with ps.  The agent will not attempt
to run if there are max_selves instances running</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spreadsheet_agent/agent.rb', line 39</span>

<span class='kw'>def</span> <span class='id identifier rubyid_max_selves'>max_selves</span>
  <span class='ivar'>@max_selves</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="page_name=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="page_name-instance_method">
  
    - (<tt>Object</tt>) <strong>page_name</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The name of the Page on the Google Spreadsheet that contains the record to
be worked on by the agent</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


21
22
23</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spreadsheet_agent/agent.rb', line 21</span>

<span class='kw'>def</span> <span class='id identifier rubyid_page_name'>page_name</span>
  <span class='ivar'>@page_name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="prerequisites=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="prerequisites-instance_method">
  
    - (<tt>Object</tt>) <strong>prerequisites</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Optional array of prerequisite fields that must contain a 1 in them for the
record on the page before the agent will attempt to run</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


35
36
37</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spreadsheet_agent/agent.rb', line 35</span>

<span class='kw'>def</span> <span class='id identifier rubyid_prerequisites'>prerequisites</span>
  <span class='ivar'>@prerequisites</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="subsumes=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="subsumes-instance_method">
  
    - (<tt>Object</tt>) <strong>subsumes</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Array of fields on the record which this agent subsumes.  If the agent
completes successfully these fields will be updated with a 1 in addition to
the field for the agent</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


48
49
50</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spreadsheet_agent/agent.rb', line 48</span>

<span class='kw'>def</span> <span class='id identifier rubyid_subsumes'>subsumes</span>
  <span class='ivar'>@subsumes</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="worksheet-instance_method">
  
    - (<tt>Object</tt>) <strong>worksheet</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Readonly access to the GoogleDrive::Worksheet that is being access by the
agent.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


51
52
53</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spreadsheet_agent/agent.rb', line 51</span>

<span class='kw'>def</span> <span class='id identifier rubyid_worksheet'>worksheet</span>
  <span class='ivar'>@worksheet</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="get_entry-instance_method">
  
    - (<tt>Object</tt>) <strong>get_entry</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the GoogleDrive::List object for the specified keys</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spreadsheet_agent/agent.rb', line 169</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_entry'>get_entry</span>
  <span class='id identifier rubyid_this_entry'>this_entry</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>if</span> <span class='ivar'>@worksheet</span>
    <span class='ivar'>@worksheet</span><span class='period'>.</span><span class='id identifier rubyid_list'>list</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_this_row'>this_row</span><span class='op'>|</span>
      <span class='id identifier rubyid_keep_row'>keep_row</span> <span class='op'>=</span> <span class='kw'>true</span>

      <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>key_fields</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_key_field'>key_field</span><span class='op'>|</span>
        <span class='op'>!</span><span class='lparen'>(</span><span class='ivar'>@config</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>key_fields</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_key_field'>key_field</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>required</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='lparen'>(</span><span class='ivar'>@keys</span><span class='lbracket'>[</span><span class='id identifier rubyid_key_field'>key_field</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
        <span class='kw'>break</span> <span class='kw'>unless</span> <span class='id identifier rubyid_keep_row'>keep_row</span>
        <span class='id identifier rubyid_keep_row'>keep_row</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_this_row'>this_row</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='ivar'>@keys</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    
      <span class='kw'>if</span> <span class='id identifier rubyid_keep_row'>keep_row</span>
        <span class='kw'>return</span> <span class='id identifier rubyid_this_row'>this_row</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process!-instance_method">
  
    - (<tt>Object</tt>) <strong>process!</strong>(&amp;agent_code) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>If the agent does not have any conflicting processes (max_selves or
conflicts_with) and if the entry is ready (field 'ready' has a 1), and all
prerequisite fields have a 1, gets the GoogleDrive::List record, and passes
it to the supplied agent_code PROC as argument. This PROC must return a
required boolean field indicating success or failure, and an optional hash
of key - value fields that will be updated on the GoogleDrive::List record.
Note, the updates are made regardless of the value of success.  In fact,
the agent can be configured to update different fields based on success or
failure.   Also, note that any value can be stored in the hash.  This
allows the agent to communicate any useful information to the google
spreadsheet for other agents (SpreadsheetAgent::Agent,
SpreadsheetAgent::Runner, or human) to use. The PROC must try at all costs
to avoid terminating. If an error is encountered, it should return false
for the success field to signal that the process failed.  If no errors are
encountered it should return true for the success field.</p>

<pre class="code ruby"><code class="ruby">Exits successfully, enters a 1 in the agent_name field
$agent-&gt;process! do |entry|
  true
end

Same, but also updates the 'notice' field in the record along with the 1 in the agent_name field
$agent-&gt;process! do |entry|
  [true, {:notice =&gt; 'There were 30 files processed'}]
end

Fails, enters f:#{hostname} in the agent_name field
$agent-&gt;process! do |entry|
  false

Same, but also updates the 'notice' field in the record along with the failure notice
$agent-&gt;process! do |entry|
  [false, {:notice =&gt; 'There were 10 files left to process!' }]
end

This agent passes different parameters based on success or failure
$agent-&gt;process! do |entry|
  if $success
    true
  else
    [ false, {:notice =&gt; 'there were 10 remaining files'}]
  end
end</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spreadsheet_agent/agent.rb', line 133</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process!'>process!</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_agent_code'>agent_code</span><span class='rparen'>)</span>
  <span class='ivar'>@worksheet</span><span class='period'>.</span><span class='id identifier rubyid_reload'>reload</span>
  <span class='id identifier rubyid_no_problems'>no_problems</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_capture_output'>capture_output</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>unless</span> <span class='ivar'>@debug</span>
    <span class='id identifier rubyid_capture_output'>capture_output</span> <span class='op'>=</span> <span class='const'>CaptureIO</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_capture_output'>capture_output</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_has_conflicts'>has_conflicts</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_runnable'>runnable</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='rparen'>)</span> <span class='op'>=</span> <span class='id identifier rubyid_run_entry'>run_entry</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_entry'>entry</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>unless</span> <span class='id identifier rubyid_runnable'>runnable</span>
  
    <span class='id identifier rubyid_success'>success</span><span class='comma'>,</span> <span class='id identifier rubyid_update_entry'>update_entry</span> <span class='op'>=</span> <span class='id identifier rubyid_agent_code'>agent_code</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_entry'>entry</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_success'>success</span>
      <span class='id identifier rubyid_complete_entry'>complete_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_update_entry'>update_entry</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_fail_entry'>fail_entry</span><span class='lparen'>(</span><span class='id identifier rubyid_update_entry'>update_entry</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span>
    <span class='gvar'>$stderr</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span> <span class='gvar'>$!</span> <span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_no_problems'>no_problems</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_capture_output'>capture_output</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_no_problems'>no_problems</span>
      <span class='id identifier rubyid_capture_output'>capture_output</span><span class='period'>.</span><span class='id identifier rubyid_stop'>stop</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_mail_error'>mail_error</span><span class='lparen'>(</span><span class='id identifier rubyid_capture_output'>capture_output</span><span class='period'>.</span><span class='id identifier rubyid_stop'>stop</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_no_problems'>no_problems</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Wed Sep 18 09:38:24 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.1 (ruby-1.9.3).
</div>

  </body>
</html>